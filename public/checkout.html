<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Status | Tindi Bandi</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header>
    <a href="/index.html" class="logo">ğŸ´ Tindi Bandi</a>
    <nav>
      <a href="/index.html" class="back-link">Home</a>
      <a href="/orders.html" class="back-link">Orders</a>
      <a href="/cart.html" class="cart-icon">ğŸ›’ Cart <span class="cart-count" id="cart-count">0</span></a>
    </nav>
  </header>

  <section class="status-section" style="text-align:center; padding:40px 20px;">
    <h2>Payment Successful!</h2>
    <p>Your Order ID: <strong id="order-id">--</strong></p>
    <p>Total Paid: â‚¹<span id="order-total">0</span></p>

    <div class="progress-bar" style="max-width:400px;margin:30px auto;display:flex;justify-content:space-between;">
      <div class="step active">Preparing</div>
      <div class="step">On the Way</div>
      <div class="step">Delivered</div>
    </div>

    <div id="order-status" style="margin:20px 0;color:#ff7b00;font-weight:bold;"></div>

    <p style="margin-top:20px;">
      <a href="/orders.html" style="color:#ff7b00; text-decoration:underline;">View My Orders</a>
    </p>
  </section>

  <footer class="footer">
    <div class="footer-container">
      <div class="footer-about">
        <h3>ğŸ´ Tindi Bandi</h3>
        <p>Delicious food delivered to your doorstep. Fresh ingredients, quick service, and unbeatable taste!</p>
      </div>
      <div class="footer-links">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="/index.html">Home</a></li>
          <li><a href="/orders.html">Orders</a></li>
          <li><a href="/index.html#starters">Starters</a></li>
          <li><a href="/index.html#main-course">Main Course</a></li>
          <li><a href="/index.html#desserts">Desserts</a></li>
          <li><a href="/index.html#beverages">Beverages</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>Â© 2025 Tindi Bandi. All Rights Reserved.</p>
    </div>
  </footer>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/app.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // Load order info from localStorage
    const lastOrder = JSON.parse(localStorage.getItem('lastOrder') || '{}');
    const orderId = lastOrder.orderId;
    const total = lastOrder.total;
    
    // Display order info
    const orderIdEl = document.getElementById('order-id');
    const orderTotalEl = document.getElementById('order-total');
    
    if (orderId) {
      orderIdEl.textContent = orderId;
    } else {
      orderIdEl.textContent = 'Loading...';
    }
    
    if (total) {
      orderTotalEl.textContent = total.toFixed(2);
    }
    
    // Auto-progress order status
    const steps = document.querySelectorAll('.step');
    const statusDiv = document.getElementById('order-status');
    let currentStep = 0;
    
    function updateStatus() {
      // Remove active class from all steps
      steps.forEach(step => step.classList.remove('active'));
      
      // Add active class to current and previous steps
      for (let i = 0; i <= currentStep; i++) {
        if (steps[i]) {
          steps[i].classList.add('active');
        }
      }
      
      // Update status text
      const statusTexts = ['Preparing your delicious meal...', 'Driver is on the way!', 'Order delivered! Enjoy your meal!'];
      if (statusDiv && statusTexts[currentStep]) {
        statusDiv.textContent = statusTexts[currentStep];
      }
      
      // Move to next step after 2 seconds (except for the last step)
      if (currentStep < steps.length - 1) {
        currentStep++;
        setTimeout(updateStatus, 2000); // 2 seconds delay
      } else {
        // Order completed - update status in database
        updateOrderStatusInDB(orderId, 'Delivered');
      }
    }
    
    function updateOrderStatusInDB(orderId, status) {
      if (!orderId) return;
      
      fetch(`/api/order/${orderId}/status`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ status })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          console.log(`Order ${orderId} status updated to: ${status}`);
        } else {
          console.error('Failed to update order status:', data.error);
        }
      })
      .catch(error => {
        console.error('Error updating order status:', error);
      });
    }
    
    // Start status progression
    if (orderId) {
      updateStatus();
    }
  });
  </script>
</body>
</html>
